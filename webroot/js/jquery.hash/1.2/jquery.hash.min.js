/*!
 * jquery.hash.js
 * @author ydr.me
 * @version 1.2
 * 2014年6月27日17:40:16
 */
!function(t,n){"use strict";function s(t){this.options=t}var e={hash:""},i=encodeURIComponent,h=decodeURIComponent,u=[],a={},r={},c={},o={"!":"/","?":"="},f={"!":"/","?":"&"},l=/^[^#]*/,_=/^(#[^#]*)(#?.*)$/,p=$.isArray,y=$.inArray,v=$.each;$.hash=function(n){"string"===$.type(n)&&(n={hash:n});var i=$.extend({},e,n);return i.hash=i.hash||t.location.hash,new s(i)._parse()},$.hash.defaults=e,$(t).bind("hashchange",function(t){var s,e=$.hash(t.newURL).get(),i=$.hash(t.oldURL).get(),h={},o=[],f=[],l=[],_=[];v(e,function(t,s){i[t]!==s&&h[t]===n&&(h[t]={old:i[t],"new":s},o.push(t))}),v(i,function(t,s){e[t]!==s&&h[t]===n&&(h[t]={old:s,"new":e[t]},o.push(t))}),(s=o.length)&&(v(o,function(t,n){var s,e;a[n]&&v(a[n].callbacks,function(t,n){~y(n,f)||f.push(n)}),r[n]&&v(r[n].callbacks,function(t,n){~y(n,l)||l.push(n)}),c[n]&&(s=c[n].keys,v(s,function(t,n){return~y(n,o)?void 0:(e=!0,!1)}),e||v(c[n].callbacks,function(t,n){~y(n,_)||_.push(n)}))}),v(f,function(t,n){n(e,i)}),v(l,function(t,n){n(e,i)}),v(_,function(t,n){n(e,i)}),v(u,function(t,n){n(e,i)}))}),s.prototype={_reset:function(){var t=this;t._equal=o[t._type],t._split=f[t._type]},_parse:function(){var t,n,s,e=this,i=e.options.hash,u={};return i=i.replace(l,""),"!"!==i[1]&&"?"!==i[1]?e:(t=i.match(_),e._hash=t[1],e._suffix=t[2],e._type=e._hash[1],e._reset(),e._result=u,e._hash=e._hash.replace(/^[#!?\/]+/,""),n=e._hash.split(e._split),"!"===e._type?v(n,function(t,n){t%2?s&&(u[s]=h(n)):(s=n,n&&(u[n]=""))}):"?"===e._type&&v(n,function(t,n){var s=n.indexOf(e._equal),i=n.slice(0,s),a=h(n.slice(s+1));i&&(u[i]=a||"")}),e._result=u,e)},stringify:function(){var t=this,n=[];return v(t._result,function(s,e){n.push(s+t._equal+i(e))}),t._hash=t._type+n.join(t._split),location.hash=t._hash+t._suffix,location.hash},set:function(t,s,e){var i,h,u={},a=this;s===n?u=t:e===n?"object"===$.type(t)?(u=t,a._type=s,a._reset()):u[t]=s:(u[t]=s,a._type=e,a._reset());for(h in u)u[h]=""+u[h],a._result[h]!==u[h]&&(i=!0,a._result[h]=u[h]);return i&&a.stringify(),this},get:function(t){if(t===n)return this._result;var s=p(t),e=s?t:[t],i={},h=this;return v(e,function(t,n){i[n]=h._result[n]}),s?i:i[t]},remove:function(t){if(t===n)return this._result={},void this.stringify();var s=p(t),e=s?t:[t],i=this;v(e,function(t,n){delete i._result[n]}),i.stringify()},listen:function(){var t,s=arguments,e=s.length,i=s[0],h=s[e-1],o=2===e&&p(i),f=e>2,l=1===e,_=!o&&!f&&!l,g=[];l?t=u:_?(g=[i],t=a):f?(g=[].slice.call(s,0,e-1),t=r):(g=i,t=c),l?~y(h,t)||t.push(h):v(g,function(s,e){t[e]===n&&(t[e]={}),g.length>1&&t[e].keys===n&&(t[e].keys=[]),t[e].callbacks==n&&(t[e].callbacks=[]);var i=t[e].keys,u=t[e].callbacks;t[e].keys&&v(g,function(t,n){~y(n,i)||n===e||i.push(n)}),~y(h,u)||u.push(h)})},suffix:function(t){var s=this;return t===n?s._suffix:(s._suffix="#"+t,s.stringify(),s)}}}(this);