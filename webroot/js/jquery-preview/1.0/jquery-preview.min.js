/*!
 * jquery-preview.js
 * @author  ydr.me
 * @version 1.0
 */
(function(g,j,c){var i="jquery-preview____",l=j.document,h=function(){},a=!!j.URL&&!!j.URL.createObjectURL,b=f(),e={suffix:["png","jpg","gif"],multiple:true,$preview:null,onsuccess:h,onerror:h};g.fn.preview=function(m){return this.each(function(){var n=g(this),p=n.data(i),o=g.extend({},e,m);if(!p){n.data(i,new d(n,o));}});};g.fn.preview.defaults=e;function d(m,n){var o=n.$preview;m.change(function(){var C=this.value,q,v=0,t,u=g(),y,w=[],A=[],p,s,z=0,r=o.width(),B=o.height();o.empty();if(this.files&&this.files.length){if(a){q=n.multiple?this.files:this.files[0];for(;v<q.length;v++){t=q[v];if(k(n.suffix,t.name)){w.push(t.name);p=j.URL.createObjectURL(t);u=u.add(g('<img src="'+p+'"/>'));}else{A.push(v+1);}}o.html(u);n.onsuccess.call(this,w);if(A.length){n.onerror.call(this,A);}z=1;}}else{if(C&&(y=k(n.suffix,C))){w.push(y);if(b){this.select();p=l.selection.createRange().text;l.selection.empty();try{n.onsuccess.call(this,w);o.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)",width:r,height:B}).get(0).filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=p;z=1;}catch(x){n.onsuccess.call(this,w);g('<img src="'+p+'"/>').css({width:r,height:B}).appendTo(o);z=1;}}}else{z=1;n.onsuccess.call(this,w);}}if(!z){throw ("无法支持本地预览！");}});}function k(o,n){var m=new RegExp("[\\\\\\/]?([^\\\\\\/]*?(?:"+["png","jpg"].join("|")+"))$","i");return n.match(m);}function f(){var m=g('<div style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=image);"></div>').appendTo("body"),n=m.css("filter");m.remove();return/progid/.test(n);}})(jQuery,this);