/*!
 * jquery-drop.js
 * @author ydr.me
 * @version 1.0
 * @require http://festatic.aliapp.com/js/jquery-drag/latest/jquery-drag.min.js
 * 2014年7月9日16:45:54
 */
!function(e,t){"use strict";function o(e,t){var o=this;o.$element=r(e),o.options=t}var n="jquery-drop",r=e.$,a={type:"insert",containment:null,itemSelector:".item",duration:345,dropRatio:.1,cloneClass:"clone",dropClass:"drop",ondragover:r.noop,ondragenter:r.noop,ondragleave:r.noop,ondragout:r.noop,ondrop:r.noop},i=["insert","append","prepend"];if(!r.fn.drag)throw"require http://festatic.aliapp.com/js/jquery-drag/latest/jquery-drag.min.js";r.extend(a,r.fn.drag.defaults),r.fn.drop=function(e){var i,s,p="string"===r.type(e),d=[].slice.call(arguments,1),l=r.extend({},a);if(p&&"_"!==p[0]){if(!this.length)return;return i=r(this[0]),s=i.data(n),s||i.data(n,s=new o(i[0],l)._init()),o.prototype[e]?o.prototype[e].apply(s,d):t}return p||(l=r.extend(l,e)),this.each(function(){var e=this,t=r(e).data(n);t||r(e).data(n,t=new o(e,l)._init())})},r.fn.drop.defaults=a,o.prototype={_init:function(){var e=this,t=e.options,o=e.$element,n=r(t.containment),a=t.ondragbefore,i=t.ondragstart,s=t.ondrag,p=t.ondragend;if(n.length)return e.$containment=n,t.ondragbefore=function(){var t=[].slice.call(arguments);e._before.apply(e,t),a.apply(this,t)},t.ondragstart=function(){var t=[].slice.call(arguments);e._start.apply(e,t),i.apply(this,t)},t.ondrag=function(){var t=[].slice.call(arguments);e._move.apply(e,t),s.apply(this,t)},t.ondragend=function(){var t=[].slice.call(arguments);e._end.apply(e,t),p.apply(this,t)},o.drag(t),this},_before:function(e,t){var o=this,n=o.options,a=t.$drag,i=a.offset();a.css("position","absolute").offset(i),o.$clone=r("<"+a[0].tagName+' class="'+n.cloneClass+'"/>').insertBefore(a),o.enter=0,o.$dropTarget=null,o.$lastDropTarget=null,o.dragOffset=null},_start:function(e,t){var o=this,n=o.options,a=o.$element,s=t.$drag,p=r(n.itemSelector,a)[0].tagName;~r.inArray(n.type,i)&&(o.$drop=r("<"+p+' class="'+n.dropClass+'"/>')),o.dragSize={width:s.outerWidth(),height:s.outerHeight()}},_move:function(e,t){var o,n,r,a=this,i=a.options,s=a.$containment,p=a.$drop,d=t.$drag,l=s.find(i.itemSelector).not(d),f=d.offset(),c=a.dragSize,g={x0:f.left,y0:f.top,x1:c.width+f.left,y1:c.height+f.top},u=s.offset(),h={x0:u.left,y0:u.top,x1:u.left+s.outerWidth(),y1:u.top+s.outerHeight()},y=a._area(g,h),m=c.width*c.height,x=a.$lastDropTarget;if(a.dragOffset=f,y){switch(i.ondragover.call(s[0],e),a.nearest=r=a._nearest(l),i.type){case"insert":case"append":case"prepend":o=s,a.enter=y/m>=i.dropRatio?1:0;break;case"exchange":case"replace":o=l.eq(r.index),n=o.outerWidth()*o.outerHeight(),a.enter=r.area/n>=i.dropRatio?1:0}if(a.$dropTarget=o,a.enter){switch(i.type){case"insert":r.dir<0?p.insertBefore(l.eq(r.index)):p.insertAfter(l.eq(r.index));break;case"append":p.appendTo(s);break;case"prepend":p.prependTo(s)}i.ondragenter.call(o[0],e),x&&x[0]===o[0]||(x&&i.ondragleave.call(x[0],e),a.$lastDropTarget=o)}else i.ondragleave.call(o[0],e)}else a.$drop&&a.$drop.remove(),i.ondragout.call(s[0],e)},_area:function(e,t){var o=e.x1-e.x0,n=e.y1-e.y0,r=0;return e.y1>t.y0&&e.x0<t.x1&&e.y0<t.y1&&e.x1>t.x0&&(e.y0<t.y0?n=e.y1-t.y0:e.y1>t.y1&&(n=t.y1-e.y0),e.x0<t.x0?o=e.x1-t.x0:e.x1>t.x1&&(o=t.x1-e.x0),r=o*n),r},_nearest:function(e){var o,n,a,i,s=this,p=s.dragOffset,d=s.dragSize,l={x0:p.left,y0:p.top,x1:p.left+d.width,y1:p.top+d.height,x:p.left+d.width/2,y:p.top+d.height/2};return e.each(function(e){var p=r(this),d=p.offset(),f=p.outerWidth(),c=p.outerHeight(),g={x0:d.left,y0:d.top,x1:d.left+f,y1:d.top+c,x:d.left+f/2,y:d.top+c/2},u=l.x>=g.x?1:-1,h=Math.sqrt(Math.pow(l.x-g.x,2)+Math.pow(l.y-g.y,2));(o===t||o>=h)&&(o=h,a=u,n=e,i=s._area(l,g))}),{distance:o,index:n,dir:a,area:i}},_end:function(e,t){var o,n,a,i=this,s=i.options,p=i.nearest,d=t.$drag,l=i.$containment,f=i.$drop,c=i.$clone,g=i.$dropTarget,u=l.find(s.itemSelector).not(d),h=l[0];if(i.enter){switch(o=g.offset(),s.type){case"insert":u.length?p.dir<0?d.insertBefore(u.eq(p.index)):d.insertAfter(u.eq(p.index)):(n=1,l.append(d));break;case"append":case"prepend":l[s.type](d);break;case"exchange":a=r('<b style="display:none;"/>').insertAfter(d),d.insertAfter(g),g.insertAfter(a),a.remove();break;case"replace":d.insertAfter(g),g.remove(),g=null}f?n?d.css("position","").offset(i.dragOffset).animate({top:"",left:""},s.duration,function(){f.remove(),c.remove()}):d.offset(i.dragOffset).animate(f.position(),s.duration,function(){d.css({left:"",top:"",position:""}),f.remove(),c.remove()}):(d.css("position","").offset(i.dragOffset).animate({top:"",left:""},s.duration,function(){g||c.remove()}),g&&g.css("position","absolute").offset(o).animate(c.position(),s.duration,function(){g.css({left:"",top:"",position:""}),c.remove()})),s.ondrop.call(h,e)}else i.dragOffset?(f&&f.remove(),d.offset(i.dragOffset).animate(c.position(),s.duration,function(){d.css({left:"",top:"",position:""}),c.remove()})):(d.css({position:"",top:"",left:""}),c.remove());s.ondragout.call(h,e),g&&s.ondragleave.call(g[0],e)},options:function(e,o){if("string"===r.type(e)&&o===t)return this.options[e];var n={};"object"===r.type(e)?n=e:n[e]=o,this.options=r.extend(this.options,n)}}}(this);