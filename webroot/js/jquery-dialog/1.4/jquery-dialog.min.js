/*!
 * jquery.fn.dialog
 * @author 云淡然 http://qianduanblog.com
 * @for ie9(含)+、chrome、firefox
 * @require http://festatic.aliapp.com/js/jquery-dialog/css/default.css
 * @require jquery-drag.js
 * @version 1.4
 * 2014年2月18日19:42:17
 */
(function(i,h,j){var x,u="jquery-dialog____",g=0,a=[],b={},l=i(window).width(),o=2000,w=74,n=/^auto$/i,s=/\d/,e=0,r=function(){},m={css:"http://festatic.aliapp.com/css/jquery-dialog/default.min.css?v="+Math.ceil(Date.now()/86400000),title:"Untitled",autoOpen:false,width:600,height:"auto",zIndex:2000,overflow:"scroll",duration:123,draggable:true,closeOnEsc:true,closeOnBg:true,canHide:true,url:"",onopen:r,onclose:r};i.fn.dialog=function(){var y=arguments,z=y.length;return this.each(function(){var I,M=i(this),B=u+Date.now(),E="<div style='position:absolute;' class='"+u+"' id='"+B+"'><div class='"+u+"wrap'><div class='"+u+"header'><span class='"+u+"title'></span><a class='"+u+"close' href='javascript:;'>&times;</a></div><div class='"+u+"body'></div></div></div>",K="<div class='"+u+"bg' id='"+B+"bg'></div>",D={},H=r,L,G,C,F,A;if(p(M,"hasInit")===j){p(M,"hasInit",0);}if(p(M,"isOpen")===j){p(M,"isOpen",0);}F=p(M,"hasInit");A=p(M,"isOpen");if(y[0]==="open"){if(z==3){D=y[1];H=y[2];}else{if(i.isPlainObject(y[1])){D=y[1];}else{if(i.isFunction(y[1])){H=y[1];}}}J(D,function(){if(i.isPlainObject(y[1])&&y[1].url!==j&&y[1].url!==""){M.empty();}d(M,function(){k(M,D);H.call(M[0]);});});}else{if(y[0]==="position"){J(D,function(){f(M);});}else{if(y[0]==="close"){J(D,function(){c(M);});}else{J(y[0]);}}}function J(N,P){L=p(M,"options");if(F){k(M,L);if(L.autoOpen){d(M);}if(P){P();}}else{L=i.extend({},m,N);if(L.zIndex>o){o=L.zIndex;}p(M,"id",B);p(M,"options",L);b[B]=M[0];if(!g){i('<link rel="stylesheet" href="'+L.css+'" />').appendTo("head").load(function(){g=1;O();}).error(function(){alert("jquery-dialog样式加载失败，请稍后再试！");return;});}else{O();}function O(){var Q=0;p(M,"hasInit",1);$bg=i(K).appendTo("body");C=i(E).appendTo("body");C.hide();M.show();C.on("click","."+u+"close",function(){c(M);});k(M,L,M);if(i.fn.drag&&L.draggable){C.drag({handle:"."+u+"header"});}if(L.autoOpen){d(M);}if(P){P();}}}}});};i.fn.dialog.defaults=m;i(document).keyup(function(A){var y=q(),z={};if(A.which==27&&y&&y.length){z=p(y,"options");if(z.canHide&&z.closeOnEsc){c(y);}}});i(document).on("click","."+u+"bg",function(){var y=q(),z={};if(y&&y.length){z=p(y,"options");if(z.canHide&&z.closeOnBg){c(y);return false;}}});i(h).resize(function(){var y=i(h).width();if(e){clearTimeout(e);e=0;}if(l!=y){e=setTimeout(function(){t();l=i(h).width();},123);}});function p(y,A,z){return z===j?y.data(u+A):y.data(u+A,z);}function t(){var B=0,y=a.length,C=[],A=i(h).width(),z=i();for(;B<y;B++){z=z.add("#"+a[B]);C.push(a[B]);}B=0;z.each(function(){var D=i(b[C[B]]),F=i("#"+C[B]),E=p(D,"options"),G=isNaN(parseInt(E.width))?m.width:parseInt(E.width);if(G+10>A){F.width(A);}else{F.width(G);}f(D);B++;});}function k(z,C,D){if(!z.length){return;}var Q,A=p(z,"options"),E={},I=p(z,"hasInit"),K=p(z,"id"),G=i(h).width(),O=i(h).height(),P=i("#"+K),y=i("#"+K+"bg"),J=i("."+u+"title",P),B=i("."+u+"close",P),M=i("."+u+"body",P),H,N,L=0,F=isNaN(parseInt(C.width))?m.width:parseInt(C.width);if(D!==j){M.html(D);}if(C.url){E.url="";H=i('<iframe src="'+C.url+'" style="width:100%;overflow:hidden;border:0;display:none;"></iframe>');z.html(H);N=i("<p style='font-size:20px;text-align: center;color: #888;'>加载中……</p>").appendTo(z);H.load(function(){var R=400;N.remove();H.show();try{R=Math.max(H.contents().find("html").outerHeight(),H.contents().find("body").outerHeight());}catch(S){}if(!R){R=400;}H.height(R);f(z);});}if(C.title!==j){J.html(C.title);E.title=C.title;}if(C.width!==j){P.width(C.width);E.width=C.width;}if(F+10>G){P.width(G);}else{P.width(F);}if(!n.test(C.height)){E.height=C.height;E.overflow=C.overflow||m.overflow;L=C.height=="100%"?O:parseInt(C.height);M.css({height:L-w,"overflow-y":E.overflow});}if(C.zIndex&&C.zIndex>o){o=C.zIndex;y.css("z-index",o);P("z-index",++o);E.zIndex=o;}if(C.duration){E.duration=C.duration;}if(C.closeOnEsc!==j){E.closeOnEsc=C.closeOnEsc;}if(C.closeOnBg!==j){E.closeOnBg=C.closeOnBg;}if(C.canHide===false){B.hide();E.canHide=false;}else{B.show();E.canHide=true;}if(C.onopen!==j){E.onopen=C.onopen;}if(C.onclose!==j){E.onclose=C.onclose;}p(z,"options",i.extend({},A,E));}function v(z){if(!z.length){return;}var G,F=i(h).width(),B=i(h).height(),E=i(h).scrollLeft(),A=i(h).scrollTop(),C=z.width(),y=z.height(),H=(F-C)/2+E,D=(B-y)/3+A;if(H<E){H=E+5;}if(D<A){D=A+5;}return{l:H,t:D,s:A,h:y};}function d(H,F){var E,y=p(H,"isOpen"),C=p(H,"hasInit"),G=p(H,"options"),z=p(H,"id"),A=i("#"+z),B=i("#"+z+"bg"),D=v(A);if(!y&&C){A.css({left:D.l,top:D.s-D.h,display:"block"});B.css("z-index",++o).show().fadeTo(G.duration/2,0.5,function(){A.css("z-index",++o).animate({top:D.t},G.duration,function(){p(H,"isOpen",1);a.push(z);G.onopen.call(A);if(F){F();}});});}}function f(y){var A,C=p(y,"isOpen"),B=p(y,"hasInit"),z=p(y,"options"),F=p(y,"id"),D=i("#"+F),E=v(D);if(C&&B){D.animate({left:E.l,top:E.t},z.duration/2);}}function c(L,J){var I,y=p(L,"isOpen"),F=p(L,"hasInit"),K=p(L,"options"),A=p(L,"id"),C,D,H=i(h).width(),E=i(h).height(),B=i(h).scrollTop(),z=0,G=B-z;if(y&&F){C=i("#"+A);D=i("#"+A+"bg");z=C.height();C.animate({top:G},K.duration,function(){i(this).hide();D.fadeOut(K.duration/2,function(){var M=i.inArray(A,a);L.data(u+"isOpen",0);if(M!=-1){a.splice(M,1);}K.onclose.call(C);if(i.isFunction(J)){J();}});});}}function q(){return i(b[a[a.length-1]]);}})($,this);