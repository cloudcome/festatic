/*!
 * jquery.fn.dialog
 * @author 云淡然 http://qianduanblog.com
 * @for ie9(含)+、chrome、firefox
 * @require http://festatic.aliapp.com/js/jquery-dialog/css/default.css
 * @require jquery-drag.js
 * @version 1.3
 * 2013年11月23日19:50:17
 */
(function(g,h){var r,o="jquery-dialog____",e=0,b=[],a=[],l=2000,q=74,k=/^auto$/i,n=/\d/,j={css:"http://festatic.aliapp.com/css/jquery-dialog/default.min.css?v="+Math.ceil(Date.now()/86400000),title:"Untitled",autoOpen:false,width:"600px",height:"auto",zIndex:2000,overflow:"scroll",duration:123,draggable:true,closeOnEsc:true,closeOnBg:true,canHide:true,url:"",onopen:function(){},onclose:function(){}};g.fn.dialog=function(){var s=arguments,t=s.length;return this.each(function(){var B,E=g(this),v=o+new Date().getTime(),x="<div style='position:absolute;' class='"+o+"' id='"+v+"'><div class='"+o+"wrap'><div class='"+o+"header'><span class='"+o+"title'></span><a class='"+o+"close' href='javascript:;'>&times;</a></div><div class='"+o+"body'></div></div></div>",C="<div class='"+o+"bg' id='"+v+"bg'></div>",D,A,w,y,u;if(E.data(o+"hasInit")===h){E.data(o+"hasInit",0);}if(E.data(o+"isOpen")===h){E.data(o+"isOpen",0);}y=E.data(o+"hasInit");u=E.data(o+"isOpen");if(s[0]==="open"){c(E,g.isFunction(s[1])?s[1]:function(){if(g.isPlainObject(s[1])){i(E,s[1]);}});}else{if(s[0]==="position"){f(E);}else{if(s[0]==="close"){d(E);}else{D=g.extend({},j,s[0]);if(D.zIndex>l){l=D.zIndex;}if(!y){E.data(o+"id",v);E.data(o+"options",D);b.push(E[0]);if(!e){g('<link rel="stylesheet" href="'+D.css+'" />').appendTo("head").load(function(){e=1;z();}).error(function(){alert("jquery-dialog样式加载失败，请稍后再试！");return;});}else{z();}function z(){var F=0;E.data(o+"hasInit",1);$bg=g(C).appendTo("body");w=g(x).appendTo("body");w.hide();E.show();w.on("click","."+o+"close",function(){d(E);});i(E,D,E);if(g.fn.drag&&D.draggable){w.drag({handle:"."+o+"header"});}if(D.autoOpen){c(E);}}}else{if(D.autoOpen){c(E);}}}}}});};g.fn.dialog.defaults=j;g(document).keyup(function(u){var s=m(),t={};if(u.which==27&&s&&s.length){t=s.data(o+"options");if(t.canHide&&t.closeOnEsc){d(s);}}});g(document).on("click","."+o+"bg",function(){var s=m(),t={};if(s&&s.length){t=s.data(o+"options");if(t.canHide&&t.closeOnBg){d(s);return false;}}});function i(D,C,t){if(!D.length){return;}var y,s=D.data(o+"options"),u=D.data(o+"id"),v=g("#"+u),x=g("."+o+"title",v),z=g("."+o+"close",v),w=g("."+o+"body",v),B,A=0;if(C.canHide===false){z.hide();}else{z.show();}if(t!==h){w.html(t);}else{if(C.url){B=g('<iframe src="'+C.url+'" style="width:100%;overflow:hidden;border:0;"></iframe>');D.html(B);}}if(C.title!==h){x.html(C.title);}if(C.width!==h){w.width(C.width);}if(!k.test(C.height)){A=C.height=="100%"?g(window).height():parseInt(C.height);w.css({height:A-q,"overflow-y":C.overflow});}if(B){B.load(function(){var E=400;try{E=Math.max(B.contents().find("html").outerHeight(),B.contents().find("body").outerHeight());}catch(F){}if(!E){E=400;}B.height(E);f(D);});}D.data(o+"options",g.extend({},s,C));}function p(t){if(!t.length){return;}var A,z=g(window).width(),v=g(window).height(),y=g(window).scrollLeft(),u=g(window).scrollTop(),w=t.width(),s=t.height(),B=(z-w)/2+y,x=(v-s)/3+u;if(B<y){B=y+5;}if(x<u){x=u+5;}return{l:B,t:x,s:u,h:s};}function c(B,z){var y,s=B.data(o+"isOpen"),w=B.data(o+"hasInit"),A=B.data(o+"options"),t=B.data(o+"id"),u=g("#"+t),v=g("#"+t+"bg"),x=p(u);if(!s&&w){u.css({left:x.l,top:x.s-x.h,display:"block"});l++;v.css("z-index",l).show().fadeTo(A.duration/2,0.5,function(){l++;u.css("z-index",l).animate({top:x.t},A.duration,function(){B.data(o+"isOpen",1);a.push(t);A.onopen.call(u);if(z){z.call(u);}});});}}function f(s){var u,w=s.data(o+"isOpen"),v=s.data(o+"hasInit"),t=s.data(o+"options"),z=s.data(o+"id"),x=g("#"+z),y=p(x);if(w&&v){x.animate({left:y.l,top:y.t},t.duration/2);}}function d(F,D){var C,s=F.data(o+"isOpen"),z=F.data(o+"hasInit"),E=F.data(o+"options"),u=F.data(o+"id");if(s&&z){var C,w=g("#"+u),x=g("#"+u+"bg"),B=g(window).width(),y=g(window).height(),v=g(window).scrollTop(),t=w.height(),A=v-t;w.animate({top:A},E.duration,function(){g(this).hide();x.fadeOut(E.duration/2,function(){var G=g.inArray(u,a);F.data(o+"isOpen",0);if(G!=-1){a.splice(G,1);}E.onclose.call(w);if(g.isFunction(D)){D.call(w);}});});}}function m(){var s,t=a.length;g(b).each(function(){if(g(this).data(o+"id")==a[t-1]){s=g(this);return;}});return s;}})(jQuery);