/*!
 * jquery.fn.dialog
 * @author 云淡然 http://qianduanblog.com
 * @for ie9(含)+、chrome、firefox
 * @require http://festatic.aliapp.com/js/jquery-dialog/css/default.css
 * @require jquery-drag.js
 * @version 1.1
 * 2013年10月10日23:28:10
 */
(function(h,f){var m,i="jquery-dialog____",n=0,j=[],l=[],k=2000,c=74,d=/^auto$/i,a=/\d/,g={css:"http://festatic.aliapp.com/css/jquery-dialog/default.min.css",title:"Untitled",autoOpen:false,width:"600px",height:"auto",overflow:"scroll",duration:123,draggable:true,closeOnEsc:true,onopen:function(){},onclose:function(){}};h.fn.dialog=function(){var o=arguments,p=o.length;return this.each(function(){var v,z=h(this),r=i+new Date().getTime(),t="<div style='position:absolute;' class='"+i+"' id='"+r+"'><div class='"+i+"wrap'><div class='"+i+"header'><span class='"+i+"title'></span><a class='"+i+"close' href='javascript:;'>&times;</a></div><div class='"+i+"body'></div></div></div>",x="<div class='"+i+"bg' id='"+r+"bg'></div>",y,s,u,q,w=0;if(z.data(i+"isInit")===f){z.data(i+"isInit",0);}if(z.data(i+"isOpen")===f){z.data(i+"isOpen",0);}u=z.data(i+"isInit");q=z.data(i+"isOpen");if(o[0]==="open"){e(o[0],z,o[1]);}else{if(o[0]==="position"){e(o[0],z);}else{if(o[0]==="close"){b(z,o[1]);}else{if(!u){y=h.extend({},g,o[0]);z.data(i+"isInit",1);z.data(i+"id",r);z.data(i+"options",y);j.push(z[0]);if(!n){n=1;if(y.css){h("head").append('<link rel="stylesheet" href="'+y.css+'" />');}}$bg=h(x).appendTo("body");s=h(t).appendTo("body");s.find("."+i+"body").append(z);s.find("."+i+"title").html(y.title);s.css({width:y.width,height:y.height}).hide();z.show();if(!d.test(y.height)){w=y.height=="100%"?h(window).height():parseInt(y.height);s.find("."+i+"body").css({height:w-c,"overflow-y":y.overflow});}if(y.autoOpen){e("open",z);}s.on("click","."+i+"close",function(){b(z);});if(h.fn.drag&&y.draggable){s.drag({handle:"."+i+"header"});}}else{y=z.data(i+"options");if(y.autoOpen){e("open",z);}}}}}});};h.fn.dialog.defaults=g;h(document).keyup(function(r){var o,p=l.length,q={};if(r.which==27&&p>0){h(j).each(function(){if(h(this).data(i+"id")==l[p-1]){o=h(this);return;}});q=o.data(i+"options");if(q.closeOnEsc){b(o);}}});function e(s,q,t){var F,y=q.data(i+"isOpen"),C=q.data(i+"isInit"),r=q.data(i+"options"),z=q.data(i+"id"),E=h("#"+z),p=h("#"+z+"bg"),w=h(window).width(),B=h(window).height(),o=h(window).scrollLeft(),D=h(window).scrollTop(),u=E.width(),A=E.height(),x=(w-u)/2+o,v=(B-A)/3+D;if(x<o){x=o;}if(v<D){v=D;}if(s=="open"&&!y&&C){E.css({left:x,top:D-A,display:"block"});k++;p.css("z-index",k).show().fadeTo(r.duration/2,0.5,function(){k++;E.css("z-index",k).animate({top:v},r.duration,function(){q.data(i+"isOpen",1);l.push(z);r.onopen.call(E);if(h.isFunction(t)){t.call(E);}});});}else{if(s=="position"&&C&&y){E.animate({left:x,top:v},r.duration/2);}}}function b(B,z){var y,o=B.data(i+"isOpen"),v=B.data(i+"isInit"),A=B.data(i+"options"),q=B.data(i+"id");if(o&&v){var y,s=h("#"+q),t=h("#"+q+"bg"),x=h(window).width(),u=h(window).height(),r=h(window).scrollTop(),p=s.height(),w=r-p;s.animate({top:w},A.duration,function(){h(this).hide();t.fadeOut(A.duration/2,function(){var C=h.inArray(q,l);B.data(i+"isOpen",0);if(C!=-1){l.splice(C,1);}A.onclose.call(s);if(h.isFunction(z)){z.call(s);}});});}}})(jQuery);