/*!
 * jquery.fn.dialog
 * @author 云淡然 http://qianduanblog.com
 * @for ie9(含)+、chrome、firefox
 * @require http://festatic.aliapp.com/js/jquery-dialog/css/default.css
 * @require jquery-drag.js
 * @version 1.0
 * 2013年9月24日10:31:37
 */
(function(e,c){var j,f="dialog____",k=0,g=[],i=[],h=2000,d={css:"http://festatic.aliapp.com/css/jquery-dialog/default.min.css",title:"Untitled",autoOpen:false,width:"600px",height:"auto",duration:123};e.fn.dialog=function(l){return this.each(function(){var r,u=e(this),n=f+new Date().getTime(),p="<div style='position:absolute;' class='"+f+"' id='"+n+"'><div class='"+f+"wrap'><div class='"+f+"header'><span class='"+f+"title'></span><a class='"+f+"close' href='javascript:;'>&times;</a></div><div class='"+f+"body'></div></div></div>",s="<div class='"+f+"bg' id='"+n+"bg'></div>",t,o,q,m;if(u.data(f+"isInit")===c){u.data(f+"isInit",0);}if(u.data(f+"isOpen")===c){u.data(f+"isOpen",0);}q=u.data(f+"isInit");m=u.data(f+"isOpen");if(l==="open"){b(u);}else{if(l==="close"){a(u);}else{if(!q){t=e.extend({},d,l);u.data(f+"isInit",1);u.data(f+"id",n);u.data(f+"options",t);g.push(u[0]);if(!k){k=1;if(t.css){if(document.all){document.createStyleSheet(t.css);}else{e("head").append('<link rel="stylesheet" href="'+t.css+'" />');}}}$bg=e(s).appendTo("body");o=e(p).appendTo("body");o.find("."+f+"body").append(u);o.find("."+f+"title").html(t.title);o.css({width:t.width,height:t.height}).hide();u.show();if(t.autoOpen){b(u);}o.on("click","."+f+"close",function(){a(u);});console.log(o.css("position"));if(e.fn.drag){o.drag({handle:"."+f+"header"});}}}}});};e(document).keyup(function(o){var m,n=i.length;if(o.which==27&&n>0){e(g).each(function(){if(e(this).data(f+"id")==i[n-1]){m=e(this);return;}});a(m);}});function b(B,z){var x,l=B.data(f+"isOpen"),t=B.data(f+"isInit"),A=B.data(f+"options"),n=B.data(f+"id");if(!l&&t){var x,p=e("#"+n),q=e("#"+n+"bg"),w=e(window).width(),r=e(window).height(),v=e(window).scrollLeft(),o=e(window).scrollTop(),s=p.width(),m=p.height(),y=(w-s)/2+v,u=(r-m)/2+o;if(y<=0){y=0;}if(u<=0){u=0;}p.css({left:y,top:o-m,display:"block"});h++;q.css("z-index",h).show().fadeTo(A.duration/2,0.5,function(){h++;p.css("z-index",h).animate({top:u},A.duration,function(){B.data(f+"isOpen",1);i.push(n);if(e.isFunction(z)){z.call(p);}});});}}function a(y,w){var v,l=y.data(f+"isOpen"),t=y.data(f+"isInit"),x=y.data(f+"options"),n=y.data(f+"id");if(l&&t){var v,p=e("#"+n),q=e("#"+n+"bg"),s=e(window).height(),o=e(window).scrollTop(),m=p.height(),u=s+o+m,r=e("html,body").css("overflow");e("html,body").css("overflow","hidden");p.animate({top:u},x.duration,function(){e(this).hide();q.fadeOut(x.duration/2,function(){var z=e.inArray(n,i);y.data(f+"isOpen",0);e("html,body").css("overflow",r);if(z!=-1){i.splice(z,1);}if(e.isFunction(w)){w.call(p);}});});}}})(jQuery);