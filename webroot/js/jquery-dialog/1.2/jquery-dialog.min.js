/*!
 * jquery.fn.dialog
 * @author 云淡然 http://qianduanblog.com
 * @for ie9(含)+、chrome、firefox
 * @require http://festatic.aliapp.com/js/jquery-dialog/css/default.css
 * @require jquery-drag.js
 * @version 1.2
 * 2013年10月23日15:38:26
 */
(function(h,f){var n,i="jquery-dialog____",o=0,k=[],m=[],l=2000,c=74,d=/^auto$/i,a=/\d/,g={css:"http://festatic.aliapp.com/css/jquery-dialog/default.min.css?v="+Math.ceil(new Date()/86400000),title:"Untitled",autoOpen:false,width:"600px",height:"auto",overflow:"scroll",duration:123,draggable:true,closeOnEsc:true,closeOnBg:true,url:"",onopen:function(){},onclose:function(){}};h.fn.dialog=function(){var p=arguments,q=p.length;return this.each(function(){var x,B=h(this),s=i+new Date().getTime(),u="<div style='position:absolute;' class='"+i+"' id='"+s+"'><div class='"+i+"wrap'><div class='"+i+"header'><span class='"+i+"title'></span><a class='"+i+"close' href='javascript:;'>&times;</a></div><div class='"+i+"body'></div></div></div>",z="<div class='"+i+"bg' id='"+s+"bg'></div>",A,t,v,r,y=0;if(B.data(i+"isInit")===f){B.data(i+"isInit",0);}if(B.data(i+"isOpen")===f){B.data(i+"isOpen",0);}v=B.data(i+"isInit");r=B.data(i+"isOpen");if(p[0]==="open"){e(p[0],B,p[1]);}else{if(p[0]==="position"){e(p[0],B);}else{if(p[0]==="close"){b(B,p[1]);}else{if(!v){A=h.extend({},g,p[0]);B.data(i+"isInit",1);B.data(i+"id",s);B.data(i+"options",A);k.push(B[0]);if(!o){h('<link rel="stylesheet" href="'+A.css+'" />').appendTo("head").load(function(){o=1;w();});}else{w();}function w(){$bg=h(z).appendTo("body");t=h(u).appendTo("body");t.find("."+i+"body").append(B);t.find("."+i+"title").html(A.title);t.css({width:A.width,height:A.height}).hide();B.show();if(!d.test(A.height)){y=A.height=="100%"?h(window).height():parseInt(A.height);t.find("."+i+"body").css({height:y-c,"overflow-y":A.overflow});}t.on("click","."+i+"close",function(){b(B);});if(h.fn.drag&&A.draggable){t.drag({handle:"."+i+"header"});}if(A.autoOpen){e("open",B,function(){if(A.url){e("url",B);}});}}}else{A=B.data(i+"options");inoptions=h.extend({},g,p[0]);s=B.data(i+"id");t=h("#"+s);if(A.title!=inoptions.title){A.title=inoptions.title;t.find("."+i+"title").html(A.title);}if(A.autoOpen){e("open",B,function(){if(A.url&&inoptions.url&&inoptions.url!=A.url){A.url=inoptions.url;B.data(i+"options",A);e("iframe",B);}});}}}}}});};h.fn.dialog.defaults=g;h(document).keyup(function(r){var p=j(),q={};if(r.which==27&&p&&p.length){q=p.data(i+"options");if(q.closeOnEsc){b(p);}}});h("body").on("click","."+i+"bg",function(){var p=j(),q={};if(p&&p.length){q=p.data(i+"options");if(q.closeOnBg){b(p);}}});function e(t,r,u){var H,A=r.data(i+"isOpen"),E=r.data(i+"isInit"),s=r.data(i+"options"),B=r.data(i+"id"),G=h("#"+B),q=h("#"+B+"bg"),y,x=h(window).width(),D=h(window).height(),p=h(window).scrollLeft(),F=h(window).scrollTop(),v=G.width(),C=G.height(),z=(x-v)/2+p,w=(D-C)/3+F;if(z<p){z=p;}if(w<F){w=F;}if(t=="open"&&!A&&E){G.css({left:z,top:F-C,display:"block"});l++;q.css("z-index",l).show().fadeTo(s.duration/2,0.5,function(){l++;G.css("z-index",l).animate({top:w},s.duration,function(){r.data(i+"isOpen",1);m.push(B);s.onopen.call(G);if(h.isFunction(u)){u.call(G);}});});}else{if(t=="url"&&A&&E){y=h('<iframe src="'+s.url+'" style="width:100%;" frameborder="0"></iframe>').appendTo(r);if(d.test(s.height)){y.load(function(){var I=400;try{I=y.contents().find("html").outerHeight();}catch(J){}y.height(I);e("position",r);});}}else{if(t=="iframe"&&E){y=r.find("iframe").eq(0);if(y.length){y.attr("src",s.url);if(d.test(s.height)){y.load(function(){var I=400;try{I=y.contents().find("html").outerHeight();}catch(J){}y.height(I);e("position",r);});}}}else{if(t=="position"&&E&&A){G.animate({left:z,top:w},s.duration/2);}}}}}function b(C,A){var z,p=C.data(i+"isOpen"),w=C.data(i+"isInit"),B=C.data(i+"options"),r=C.data(i+"id");if(p&&w){var z,t=h("#"+r),u=h("#"+r+"bg"),y=h(window).width(),v=h(window).height(),s=h(window).scrollTop(),q=t.height(),x=s-q;t.animate({top:x},B.duration,function(){h(this).hide();u.fadeOut(B.duration/2,function(){var D=h.inArray(r,m);C.data(i+"isOpen",0);if(D!=-1){m.splice(D,1);}B.onclose.call(t);if(h.isFunction(A)){A.call(t);}});});}}function j(){var p,q=m.length;h(k).each(function(){if(h(this).data(i+"id")==m[q-1]){p=h(this);return;}});return p;}})(jQuery);