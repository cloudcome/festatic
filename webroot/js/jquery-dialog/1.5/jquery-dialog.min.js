/*!
 * jquery.fn.dialog
 * @author ydr.me
 * @for ie9(含)+、chrome、firefox
 * @require http://festatic.aliapp.com/js/jquery-dialog/css/default.css
 * @require jquery-drag.js
 * @version 1.5
 * 2014年2月18日20:51:19
 */
(function(h,g,i){var t="jquery-dialog____",v=0,a=[],b={},k=h(window).width(),n=2000,w=74,m=/^auto$/i,r=/\d/,e=0,q=function(){},l={css:"http://festatic.aliapp.com/css/jquery-dialog/default.min.css?v="+Math.ceil(Date.now()/86400000),title:"Untitled",autoOpen:false,width:600,height:"auto",zIndex:2000,overflow:"scroll",duration:123,draggable:true,closeOnEsc:true,closeOnBg:true,canHide:true,url:"",onopen:q,onclose:q};h.fn.dialog=function(){var x=arguments,y=x.length;return this.each(function(){var G,J=h(this),A=t+Date.now(),D="<div style='position:absolute;' class='"+t+"' id='"+A+"'><div class='"+t+"wrap'><div class='"+t+"header'><span class='"+t+"title'></span><a class='"+t+"close' href='javascript:;'>&times;</a></div><div class='"+t+"body'></div></div></div>",I="<div class='"+t+"bg' id='"+A+"bg'></div>",B,C={},F=q,E,z;if(o(J,"hasInit")===i){o(J,"hasInit",0);}if(o(J,"isOpen")===i){o(J,"isOpen",0);}E=o(J,"hasInit");z=o(J,"isOpen");if(x[0]==="open"){if(y==3){C=x[1];F=x[2];}else{if(h.isPlainObject(x[1])){C=x[1];}else{if(h.isFunction(x[1])){F=x[1];}}}H(C,function(){if(h.isPlainObject(x[1])&&x[1].url!==i&&x[1].url!==""){J.empty();}d(J,function(){j(J,C);F.call(J[0]);});},1);}else{if(x[0]==="close"){H(C,function(){c(J,x[1]);});}else{if(x[0]==="position"){H(C,function(){f(J);});}else{if(h.isPlainObject(x[0])){C=x[0];}H(C);}}}function H(M,O,L){var K={};if(E){K=h.extend({},o(J,"options"),M);j(J,M);if(!L&&K.autoOpen){d(J);}if(O){O();}}else{o(J,"hasInit",1);K=h.extend({},l,M);if(K.zIndex>n){n=K.zIndex;}o(J,"id",A);b[A]=J[0];if(!v){h('<link rel="stylesheet" href="'+K.css+'" />').appendTo("head").load(function(){v=1;N();}).error(function(){v=0;if(g.console){console.error("jquery-dialog样式加载失败，请刷新页面后重试！");}return;});}else{N();}}function N(){var P=0;$bg=h(I).appendTo("body");B=h(D).appendTo("body");B.hide();J.show();B.on("click","."+t+"close",function(){c(J);});j(J,K,J);if(h.fn.drag&&K.draggable){B.drag({handle:"."+t+"header"});}if(K.autoOpen){d(J);}if(O){O();}}}});};h.fn.dialog.defaults=l;h(document).keyup(function(z){var x=p(),y={};if(z.which==27&&x&&x.length){y=o(x,"options");if(y.canHide&&y.closeOnEsc){c(x);}}});h(document).on("click","."+t+"bg",function(){var x=p(),y={};if(x&&x.length){y=o(x,"options");if(y.canHide&&y.closeOnBg){c(x);return false;}}});h(g).resize(function(){var x=h(g).width();if(e){clearTimeout(e);e=0;}if(k!=x){e=setTimeout(function(){s();k=h(g).width();},123);}});function o(x,z,y){return y===i?x.data(t+z):x.data(t+z,y);}function s(){var A=0,x=a.length,B=[],z=h(g).width(),y=h();for(;A<x;A++){y=y.add("#"+a[A]);B.push(a[A]);}A=0;y.each(function(){var C=h(b[B[A]]),E=h("#"+B[A]),D=o(C,"options"),F=isNaN(parseInt(D.width))?l.width:parseInt(D.width);if(F+10>z){E.width(z);}else{E.width(F);}f(C);A++;});}function j(y,N,C){if(!y.length){return;}var P,z=o(y,"options"),B=h.extend({},z,N),G=o(y,"hasInit"),I=o(y,"id"),E=h(g).width(),M=h(g).height(),O=h("#"+I),x=h("#"+I+"bg"),H=h("."+t+"title",O),A=h("."+t+"close",O),K=h("."+t+"body",O),F,L,J=0,D=isNaN(parseInt(B.width))?l.width:parseInt(B.width);if(C!==i){K.html(C);}if(B.url!==""&&B.url!==i){F=h('<iframe src="'+B.url+'" style="width:100%;overflow:hidden;border:0;display:none;"></iframe>');y.html(F);L=h("<p style='font-size:20px;text-align: center;color: #888;'>加载中……</p>").appendTo(y);F.load(function(){var Q=400;L.remove();F.show();try{Q=Math.max(F.contents().find("html").outerHeight(),F.contents().find("body").outerHeight());}catch(R){}if(!Q){Q=400;}F.height(Q);f(y);});}if(B.title!==i){H.html(B.title);}if(B.width!==i){O.width(B.width);}if(D+10>E){O.width(E);}else{O.width(D);}if(!m.test(B.height)){J=B.height=="100%"?M:parseInt(B.height);K.css({height:J-w,"overflow-y":B.overflow});}if(B.zIndex&&B.zIndex>n){n=B.zIndex;x.css("z-index",n);O("z-index",++n);}if(B.canHide===false){A.hide();}else{A.show();}o(y,"options",B);}function u(y){if(!y.length){return;}var F,E=h(g).width(),A=h(g).height(),D=h(g).scrollLeft(),z=h(g).scrollTop(),B=y.width(),x=y.height(),G=(E-B)/2+D,C=(A-x)/3+z;if(G<D){G=D+5;}if(C<z){C=z+5;}return{l:G,t:C,s:z,h:x};}function d(G,E){var D,x=o(G,"isOpen"),B=o(G,"hasInit"),F=o(G,"options"),y=o(G,"id"),z=h("#"+y),A=h("#"+y+"bg"),C=u(z);if(!x&&B){z.css({left:C.l,top:C.s-C.h,display:"block"});A.css("z-index",++n).show().fadeTo(F.duration/2,0.5,function(){z.css("z-index",++n).animate({top:C.t},F.duration,function(){o(G,"isOpen",1);a.push(y);F.onopen.call(z);if(E){E();}});});}}function f(x){var z,B=o(x,"isOpen"),A=o(x,"hasInit"),y=o(x,"options"),E=o(x,"id"),C=h("#"+E),D=u(C);if(B&&A){C.animate({left:D.l,top:D.t},y.duration/2);}}function c(K,I){var H,x=o(K,"isOpen"),E=o(K,"hasInit"),J=o(K,"options"),z=o(K,"id"),B,C,G=h(g).width(),D=h(g).height(),A=h(g).scrollTop(),y=0,F=A-y;if(x&&E){B=h("#"+z);C=h("#"+z+"bg");y=B.height();B.animate({top:F},J.duration,function(){h(this).hide();C.fadeOut(J.duration/2,function(){var L=h.inArray(z,a);K.data(t+"isOpen",0);if(L!=-1){a.splice(L,1);}J.onclose.call(B);if(h.isFunction(I)){I();}});});}}function p(){return h(b[a[a.length-1]]);}})($,this);