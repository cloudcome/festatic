/*!
 * jquery.fn.selection
 * @author 云淡然 http://qianduanblog.com
 * @for ie9(含)+、chrome、firefox
 * @version 1.0
 * 2013年10月13日13:54:48
 */
(function(d,f,c){var h=f.document;d.fn.selection=function(){var o=d(this).eq(0),m=o[0],k=[],p="",n="",l=0;if(!e(m,"input")&&!e(m,"textarea")){return;}if(!o.length){return;}k=b(m);p=a(m);n=o.val();l=n.length;return{start:k[0],end:k[1],val:p,select:function(){var s=arguments,t=s.length,u=0,q=0,r;if(t==1&&d.type(s[0])=="string"){u=n.indexOf(s[0]);q=u+s[0].length;return u!=-1?j(m,u,q):false;}else{if(t==1&&d.type(s[0])=="number"){u=Math.abs(parseInt(s[0],10));q=l;return j(m,u,q);}else{if(t==2&&d.type(s[0])=="number"&&d.type(s[1])=="number"){u=Math.abs(parseInt(s[0],10));q=Math.abs(parseInt(s[1],10));if(u>q){r=q;q=u;u=r;}return j(m,u,q);}}}},to:function(q){return this.select(q,q);},toStart:function(){return this.select(0,0);},toEnd:function(){return this.select(l,l);},before:function(q,r){if(i(q)){return g(m,q,"before",r);}return false;},after:function(q,r){if(i(q)){return g(m,q,"after",r);}return false;},replace:function(q,r){if(i(q)){return g(m,q,"replace",r);}return false;},remove:function(){return g(m,"","replace");},prepend:function(r,q){this.toStart();if(i(r)){return g(m,r,"before",q);}return false;},append:function(q,r){this.toEnd();if(i(q)){return g(m,q,"before",r);}return false;},backspace:function(r){var q=0;if(d.type(r)=="number"){q=Math.abs(parseInt(r,10));}return g(m,"","backspace",q);},"delete":function(r){var q=0;if(d.type(r)=="number"){q=Math.abs(parseInt(r,10));}return g(m,"","delete",q);}};};function e(l,k){return l.nodeName&&l.nodeName.toLowerCase()===k.toLowerCase();}function i(k){return d.type(k)=="string"||d.type(k)=="number";}function b(o,l){var p,k,n,q=[],m;o.focus();if(h.activeElement&&h.activeElement===o){m=h.activeElement;q.push(m.selectionStart,m.selectionEnd);return q;}else{if(h.selection){p=h.selection;k=p.createRange();n=k.duplicate();n.moveToElementText(o);n.setEndPoint("EndToEnd",k);o.selectionStart=n.text.length-k.text.length;o.selectionEnd=o.selectionStart+k.text.length;q.push(o.selectionStart,o.selectionEnd);return q;}}return[0,0];}function a(m){var k=b(m),n=k[0],l=k[1];if(n==-1||l==-1){return null;}if(h.activeElement){return h.activeElement.value.substring(n,l);}else{}return null;}function j(m,n,k){var l;m.focus();if(h.activeElement&&h.activeElement===m){m.setSelectionRange(n,k);}else{if(h.selection){l=m.createTextRange();l.moveEnd("character",-m.value.length);l.moveEnd("character",k);l.moveStart("character",n);l.select();}else{return false;}}return a(m);}function g(o,s,u,l){var n=o.value,m="",t=n.length,v=String(s).length,k=0,q=0,r=0,p=0;o.focus();if(h.activeElement&&h.activeElement===o){k=h.activeElement.selectionStart;q=h.activeElement.selectionEnd;switch(u){case"before":default:m=n.slice(0,k)+s+n.slice(k,t);r=k;p=k+v;break;case"after":m=n.slice(0,q)+s+n.slice(q,t);r=q;p=q+v;break;case"replace":m=n.slice(0,k)+s+n.slice(q,t);r=k;p=k+v;break;case"backspace":r=q-l;if(r<0){r=0;}p=r;m=n.slice(0,r)+n.slice(q,t);break;case"delete":r=k;p=k+l;if(p>t){p=t;}m=n.slice(0,k)+n.slice(p,t);p=k;break;}o.value=m;if(Boolean(l)==true){j(o,r,p);}else{j(o,p,p);}}else{if(h.selection){}else{return false;}}}})(jQuery,this);