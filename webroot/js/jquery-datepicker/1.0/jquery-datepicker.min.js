/*!
 * jquery.fn.datepicker
 * @author ydr.me
 * @version 1.0
 */
(function(d,c,i){var p="jquery-datepicker____",o=/y{1,4}|m{1,2}|d{1,2}/ig,l=new Date(),f=l.getFullYear(),g=l.getMonth(),n=l.getDate(),k={language:{yearUnit:"年",monthUnit:"月",dayUnit:"日",weekUnit:"周",month:["一","二","三","四","五","六","七","八","九","十","十一","十二"],week:["日","一","二","三","四","五","六"],prev:"上一个",next:"下一个"},yearRange:[f-5,f+5],year:f,month:g+1,date:n,format:"yyyy年M月d日",duration:123,position:{},onopen:function(){},onclose:function(){},onchoose:function(){}};d.fn.datepicker=function(s){return this.each(function(){var u=d(this),H=p+new Date().getTime(),D="",x=d.extend({},k,s,{select:{year:f,month:g},choose:{year:-1,month:-1,date:-1}}),L,C="."+p+"prev",K="."+p+"next",z="."+p+"year",y="."+p+"month",J=z+","+y,A,G,t,F,E,I;if(u.data(p+"id")===i){--x.month;u.data(p+"id",H);u.data(p+"options",x);D+='<div id="'+H+'" class="'+p+'">';D+=q(x);D+='<table class="'+p+'table">'+a(x)+'<tbody class="'+p+'tbody">'+h(x)+"</tbody></table>";D+="</div>";d(D).appendTo("body");L=d("#"+H);L.data(p+"toggle",0);L.data(p+"isOpen",0);A=d(J,L);G=d(z,L);t=d(y,L);F=d("."+p+"year-list",L);E=d("."+p+"month-list",L);I=d("."+p+"tbody",L);L.on("click",J,function(){var P=d(this),N=d(this).next("ul"),O=d("."+p+"year,."+p+"month"),M=d("."+p+"select-list");M.fadeOut(x.duration);A.removeClass("active");if(N.css("display")=="none"){P.addClass("active");N.stop(true,true).fadeIn(x.duration);}else{N.stop(true,true).fadeOut(x.duration,function(){P.removeClass("active");});}return false;}).on("click",z+"-list li",function(){x.select.year=d(this).attr("data-year")*1;B();}).on("click",y+"-list li",function(){x.select.month=d(this).attr("data-month")*1;B();}).on("click",C,function(){if(x.select.month==0){x.select.month=11;--x.select.year;}else{--x.select.month;}B();return false;}).on("click",K,function(){if(x.select.month==11){x.select.month=0;++x.select.year;}else{++x.select.month;}B();return false;}).on("click","td span",function(){var P=d(this).parent(),O=P.attr("data-year"),N=P.attr("data-month"),M=P.attr("data-date");if(x.choose.year==O&&x.choose.month==N&&x.choose.date==M){return;}if(M){u.val(j(new Date(O,N,M),x.format)).focus();L.find("td").removeClass("active");P.addClass("active");x.choose.year=O;x.choose.month=N;x.choose.date=M;x.onchoose(O,N,M);v(L);}});d(document).click(function(N){if(N.target==u[0]||d(N.target).closest("."+p).length||L.data(p+"toggle")||!L.data(p+"isOpen")){return;}var M=d("."+p+"select-list");M.fadeOut(x.duration);A.removeClass("active");v(L);return false;});u.on("focusin click",function(){w(L);return false;});function B(){G.html(x.select.year+x.language.yearUnit);t.html(x.language.month[x.select.month]+x.language.monthUnit);I.html(h(x));A.removeClass("active");F.fadeOut(x.duration).find("li").filter(function(){return d(this).attr("data-year")==x.select.year;}).addClass("active").siblings().removeClass("active");E.fadeOut(x.duration).find("li").filter(function(){return d(this).attr("data-month")==x.select.month;}).addClass("active").siblings().removeClass("active");}}if(s==="open"){H=u.data(p+"id");L=d("#"+H);if(!L.data(p+"isOpen")){L.data(p+"toggle",1);w(L,function(){L.data(p+"toggle",0);});}}else{if(s==="close"){H=u.data(p+"id");L=d("#"+H);v(L);}}function w(P,R){if(P.data(p+"isOpen")){return;}var M=u.offset().left,O=u.offset().top,N=u.outerHeight(),Q=d.extend({},{left:M,top:O+N+7},x.position);P.data(p+"isOpen",1).css(Q).fadeIn(x.duration,function(){u.focus();if(R){R();}x.onopen();});}function v(M,N){if(!M.data(p+"isOpen")){return;}M.fadeOut(x.duration,function(){x.onclose();}).data(p+"toggle",0).data(p+"isOpen",0);}});};function q(t){var z=t.language.prev+t.language.monthUnit,w=t.language.next+t.language.monthUnit,s=m(t),y=b(t),v=t.year+t.language.yearUnit,x=t.language.month[t.month]+t.language.monthUnit,u='<div class="'+p+'header"><div class="'+p+'select"><a href="#" class="'+p+'year">'+v+"</a>"+s+'</div><div class="'+p+'select"><a href="#" class="'+p+'month">'+x+"</a>"+y+'</div><a href="#" class="'+p+'prev" title="'+z+'"></a><a href="#" class="'+p+'next" title="'+w+'"></a></div>';return u;}function m(u){var x="",y=u.language.yearUnit,w=u.yearRange[0],t=u.yearRange[1],v=[],s="";x+='<ul class="list-unstyled '+p+"select-list "+p+'year-list">';for(;w<=t;w++){v=[];s="";if(w==u.year){v.push("active");}if(w==f){v.push("current");}if(v.length){s=' class="'+v.join(" ")+'"';}x+="<li"+s+' data-year="'+w+'">'+w+y+"</li>";}x+="</ul>";return x;}function b(u){var x="",y=u.language.monthUnit,z=u.language.month,w=0,t=11,v=[],s="";x+='<ul class="list-unstyled '+p+"select-list "+p+'month-list">';for(;w<=t;w++){v=[];s="";if(w==u.month){v.push("active");}if(w==g){v.push("current");}if(v.length){s=' class="'+v.join(" ")+'"';}x+="<li"+s+' data-month="'+w+'">'+z[w]+y+"</li>";}x+="</ul>";return x;}function a(t){var w="<thead><tr>",v=0,s=6,x=t.language.weekUnit,u=t.language.week;for(;v<=s;v++){w+="<th>"+x+u[v]+"</th>";}w+="</tr></thead>";return w;}function h(w){var E="",O=w.select.year,y=w.select.month,F=new Date(O,y,1).getDay(),L=e(O,y)+F,C=y==0,P=y==11,v=C?O-1:O,N=P?O+1:O,Q=C?11:y-1,u=P?0:y+1,H=e(v,Q)-F,x=0,I=0,K=0,J=6,z=0,A=0,M=[],B="",t=0,G=0,D=0,s=Math.ceil(L/7);for(;I<s;I++){E+="<tr>";for(K=0,J=6;K<=J;K++){A++;M=[];B="";if(A>F&&A<=L){t=O;G=y;D=++z;}else{if(A<=F){t=v;G=Q;D=++H;M.push("old");}else{t=N;G=u;D=++x;M.push("new");}}if(w.choose.year==t&&w.choose.month==G&&w.choose.date==D){M.push("active");}if(f==t&&g==G&&n==D){M.push("current");}if(M.length){B=' class="'+M.join(" ")+'"';}E+='<td data-year="'+t+'" data-month="'+G+'" data-date="'+D+'" '+B+"><span>"+D+"</span></td>";}E+"</tr>";}return E;}function e(s,t){return[31,(s%4===0&&s%100!==0||s%400===0)?29:28,31,30,31,30,31,31,30,31,30,31][t];}function r(u){var s=u.replace(o,"\0").split("\0"),t=u.match(o);if(!s||!s.length||!t||t.length===0){throw new Error("Invalid date format.");}return{separators:s,parts:t};}function j(D,z){var B={"y+":D.getFullYear(),"m+":D.getMonth()+1,"d+":D.getDate()},u=r(z),v=u.separators,x=u.parts,t,E,A,C="",y,w,s;for(y in x){E=x[y];t=x[y];for(w in B){A=B[w];s=new RegExp("("+w+")","i");if(s.test(E)){E=E.replace(RegExp.$1,A);if(w=="y+"){E=E.substr(4-t.length);}else{E=RegExp.$1.length==2&&E<10?"0"+E:E;}}}C+=v[y]+E;}C+=v.pop();return C;}})(jQuery,this);