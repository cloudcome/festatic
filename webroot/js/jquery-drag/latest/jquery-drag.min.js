/*!
 * jquery.fn.drag
 * @author ydr.me
 * @version 1.2
 * 2014年7月2日17:27:42
 */
!function(t,o){"use strict";function e(t,o){this.element=t,this.options=o}var n=t.$,s=t.document,r=n(s),i=n(s.body),a="jquery-drag",p={handle:null,drag:null,axis:"xy",cursor:"move",min:null,max:null,zIndex:9999,ondragbefore:n.noop,ondragstart:n.noop,ondrag:n.noop,ondragend:n.noop};n.fn.drag=function(t){var s,r,i="string"===n.type(t),l=[].slice.call(arguments,1),d=n.extend({},p);if(i&&"_"!==i[0]){if(!this.length)return;return s=n(this[0]),r=s.data(a),r||s.data(a,r=new e(s[0],d)._init()),e.prototype[t]?e.prototype[t].apply(r,l):o}return i||(d=n.extend(d,t)),this.each(function(){var t=this,o=n(t).data(a);o||n(t).data(a,o=new e(t,d)._init())})},n.fn.drag.defaults=p,e.prototype={_init:function(){var t=this,o=t.options,e=n(t.element);return t.$element=e,o.handle?e.on("mousedown taphold",o.handle,n.proxy(t._start,t)):e.on("mousedown taphold",n.proxy(t._start,t)),r.mousemove(n.proxy(t._move,t)).mouseup(n.proxy(t._end,t)).bind("touchmove",n.proxy(t._move,t)).bind("touchend",n.proxy(t._end,t)).bind("touchcancel",n.proxy(t._end,t)),t},_start:function(t){if(!this.is){t=t.originalEvent,t.preventDefault();var o,e,s=this,r=s.options,a=s.$element,p=r.handle?n(t.target).closest(r.handle):n(t.target),l=r.drag?p.closest(r.drag):a,d=t.touches?t.touches[0]:t;a.has(l).length||(l=a),s.$drag=l,r.ondragbefore.call(l[0],t,s),s.zIndex=l.css("z-index"),s.cursor=i.css("cursor"),s.$drag=l.css("z-index",r.zIndex),o=l.css("position"),e=l.offset(),"static"===o?l.css("position","relative"):("fixed"===o||"absolute"===o)&&l.css(l.position()),s.pos={x:d.pageX,y:d.pageY,l:e.left,t:e.top},s.is=!0,s.options.cursor&&i.css("cursor",r.cursor),r.ondragstart.call(l[0],t,s)}},_move:function(t){if(this.is){t=t.originalEvent,t.preventDefault();var e,n,s,r,i=this,a=i.options,p=a.min,l=a.max,d=i.pos,c=i.$drag,u=c.parent(!0).offset(),f={},h=t.touches?t.touches[0]:t;~a.axis.indexOf("x")&&(f.left=h.pageX-d.x+d.l),~a.axis.indexOf("y")&&(f.top=h.pageY-d.y+d.t),p&&p.left!==o&&f.left<(e=p.left+u.left)&&(f.left=e),p&&p.top!==o&&f.top<(n=p.top+u.top)&&(f.top=n),l&&l.left!==o&&f.left>(s=l.left+u.left)&&(f.left=s),l&&l.top!==o&&f.top>l.top&&f.top>(r=l.top+u.top)&&(f.top=r),c.offset(f),a.ondrag.call(c[0],t,i)}},_end:function(t){if(this.is){var o=this,e=o.$drag;t.preventDefault(),o.is=!1,o.options.cursor&&i.css("cursor",o.cursor),e.css("z-index",o.zIndex),o.options.ondragend.call(e[0],t,o)}},options:function(t,e){if("string"===n.type(t)&&e===o)return this.options[t];var s={};"object"===n.type(t)?s=t:s[t]=e,this.options=n.extend(this.options,s)}}}(this);