/*!
 * jquery.validate.js
 * @author ydr.me
 * @version 1.0
 */
!function(e,t){function a(e){return e===t||null===e||""===e}function n(a,n){var r=e(n.formItemSelector,a),i=n.formItemSkipClass,u=e(),s={},o=[];return r.each(function(){i&&e(this).hasClass(i)||(u=u.add(e("input,select,textarea",this)))}),u.each(function(){var n=e(this),r=n[0].tagName.toLowerCase(),i=n.val(),u=n.attr("name"),m=n.attr("pattern"),c=n.prop("multiple"),d=n.data("equal"),f=n.data("placeholder")||"",p=n.data("type")||n.attr("type"),h={};s[u]||"hidden"===n.attr("type")||"none"===n.css("display")||(s[u]=1,("select"===r||"textarea"===r)&&(p=r),"checkbox"===p?(i=[],e("[name="+u+"]:checked",a).each(function(){i.push(this.value)})):"radio"===p?i=e("[name="+u+"]:checked",a).val():"number"===p?i=l(i):"select"!==p||c||i!==f?"select"===p&&null===i?i=[]:"file"===p&&(i=(i.match(/[^\/\\]*$/)||[""])[0]):i=t,h={elem:n[0],id:n.attr("id"),name:u,type:p,suffix:(n.data("suffix")||"").split(","),value:i,minlength:l(n.data("minlength")),maxlength:l(n.attr("maxlength")),pattern:m,reg:m?new RegExp(m):t,min:l(n.attr("min")),max:l(n.attr("max")),step:l(n.attr("step")),least:l(n.data("least")),most:l(n.data("most")),required:n.prop("required"),multiple:c,$equal:d?e("#"+n.data("equal")):[],msg:n.data("msg")||{}},o.push(h))}),o}function l(e,t){return e=1*e,isNaN(e)?t:e}function r(e,t){switch(e){case"url":return/^https?:\/\/([\w-]+\.)+([a-z]{2,6}|xn--[a-z\d]+)/i.test(t);case"email":return/^[a-z\d][\w-.]*@([\w-]+\.)+([a-z]{2,6}|xn--[a-z\d]+)$/i.test(t);case"number":return/^\d+$/.test(t);case"date":case"month":case"week":case"time":case"datetime":case"datetime-local":return i(e,t);case"color":return/^#[\da-f]{6}$/.test(t)}return!0}function i(e,t){var a,n,l,r,i,u,s,o,m,c,d,f={date:/^(\d{4})-(\d{2})-(\d{2})()()$/,month:/^(\d{4})-(\d{2})()()()$/,week:/^(\d{4})()()()()-W(\d{2})$/,time:/^()()()(\d{2}):(\d{2})$/,datetime:/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/,"datetime-local":/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})$/};return f[e].test(t)?(n=1*RegExp.$1||1,r=1*RegExp.$2||1,u=1*RegExp.$3||1,o=1*RegExp.$4||1,c=1*RegExp.$5||1,a=new Date(n,r-1,u,o,c),l=a.getFullYear(),i=a.getMonth()+1,s=a.getDate(),m=a.getHours(),d=a.getMinutes(),"date"===e?l===n&&i===r&&u===s:"month"===e?l===n&&i===r:"week"===e?l===n:"time"===e?m===o&&d===c:"datetime"===e||"datetime-local"===e?l===n&&i===r&&u===s&&m===o&&d===c:void 0):!1}var u=function(){},s=(!!("oninvalid"in document.createElement("input")),!!window.FormData),o={formItemSelector:".form-group",formItemSkipClass:"",isSkipInvalid:!1,isAutoSubmit:!0,autoSubmitOptions:{},localRules:{},remoteRules:{},onvalid:u,oninvalid:u,onfocus:u,onremote:u,onsuccess:u,oncomplete:u,onsubmit:u};return e.fn.validate=function(l){function i(){var t=e.extend({},{url:$form.attr("action")||location.href,type:$form.attr("method")||"post",data:s?new FormData($form[0]):$form.serialize()},u.autoSubmitOptions);s&&(t.processData=!1,t.contentType=!1),e.ajax(t).always(u.onsubmit)}var u=e.extend({},o,l);return this.each(function(){var l=e(this),s=n(l,u),o=s.length,m=0,c=0,d=0;return o?void!function f(){function n(t){var a=u.remoteRules[v.id][m],n=e.extend({},a);n.success=n.error=n.complete=null,u.onremote.call(v.elem),e.ajax(n).done(function(){t(a.success.apply(v.elem,arguments))}).fail(function(){t(a.error.apply(v.elem,arguments))})}function p(e){d++,c++,u.oninvalid.call(v.elem,e||"不符合要求"),u.isSkipInvalid&&o!==c?f():u.oncomplete.call(l[0])}function h(){m=0,y=0,c++,u.onvalid.call(v.elem),c===o?(u.oncomplete(l[0]),d||(u.onsuccess.call(l[0]),u.isAutoSubmit&&i())):f()}var g,v=s[c],x=u.localRules[v.id]||[],$=0,y=(x.length,(u.remoteRules[v.id]||[]).length),w=v.msg,b="";if(u.onfocus.call(v.elem),v.required&&a(v.value)){switch(v.type){case"text":default:b="此项必填";break;case"radio":case"select":case"checkbox":b="此项必选";break;case"file":b="上传文件必选"}return p(w.required||b)}if("file"===v.type&&!~e.inArray((v.value.match(/[^\.]*$/)||[""])[0],v.suffix))return p(w.suffix||"文件类型必须是"+v.suffix.join(",")+"之一");if(v.minlength&&v.value.length<v.minlength)return p(w.maxlength||"长度不能小于"+v.minlength);if(v.maxlength&&v.value.length>v.maxlength)return p(w.maxlength||"长度不能大于"+v.maxlength);if(v.reg&&!v.reg.test(v.value))return p(w.pattern||"不符合规则要求");if(!r(v.type,v.value))return p(w.type||"不符合类型要求");if("number"===v.type&&v.value!==t){if(v.value<v.min)return p(w.min||"不能小于"+v.min);if(v.value>v.max)return p(w.max||"不能大于"+v.max);if(v.value%v.step)return p(w.step||"必须是"+v.step+"的公倍数")}if(v.$equal.length&&v.value!==v.$equal.val())return p(w.equal||"填写不匹配");if("checkbox"===v.type||"select"===v.type&&v.multiple){if(v.least&&v.value.length<v.least)return p(w.least||"最少需要选择"+v.least+"项");if(v.most&&v.value.length>v.most)return p(w.most||"最多只能选择"+v.most+"项")}for($ in x)if(g=x[$].call(v.elem),!g.status)return p(g.msg);y?!function k(){n(function(e){return e.status?(m++,void(m===y?h():k())):p(e.msg)})}():h()}():u.oncomplete.call(l[0])})},e.fn.validate.defaults=o,this}(jQuery);